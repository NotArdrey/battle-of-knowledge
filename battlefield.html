<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Battle - Battle of Knowledge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles/animations.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Baloo 2', cursive; 
            -webkit-tap-highlight-color: transparent;
            overflow: hidden; /* Prevent scrolling */
            height: 100vh;
            margin: 0;
            padding: 0;
        }
        .sprite-image { 
            image-rendering: pixelated;
            pointer-events: none;
        }
        /* Touch optimization */
        .touch-target {
            min-height: 44px;
            min-width: 44px;
            touch-action: manipulation;
        }
        /* Prevent text selection on buttons */
        button {
            user-select: none;
            -webkit-user-select: none;
        }
        
        /* Battle container - fills entire screen */
        .battle-container {
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            padding: 0;
            margin: 0;
        }
        
        /* Battle platform - occupies most of the screen */
        .battle-platform {
            flex: 0 0 65%; /* Takes 65% of screen height */
            width: 100%;
            max-width: none;
            margin: 0;
            border-radius: 0;
            border-left: 0;
            border-right: 0;
        }
        
        /* Question & Answer Container - fits the remaining space */
        .question-answer-container {
            flex: 1; /* Takes remaining space */
            width: 100%;
            max-width: none;
            margin: 0;
            border-radius: 0;
            border-left: 0;
            border-right: 0;
            overflow-y: auto; /* Allow scrolling inside if needed */
            max-height: 35vh; /* Prevent from growing too large */
        }
        
        /* Responsive adjustments */
        @media (max-width: 640px) {
            .battle-platform {
                flex: 0 0 60%;
            }
            .question-answer-container {
                max-height: 40vh;
            }
            /* Mobile: Position HP bars */
            .hp-container-left {
                top: 0.5rem !important;
                left: 0.5rem !important;
            }
            .hp-container-right {
                top: 0.5rem !important;
                right: 0.5rem !important;
            }
            /* Adjust answer buttons for mobile */
            .answer-btn {
                padding: 0.5rem !important;
                min-height: 40px !important;
            }
        }
        
        @media (max-width: 480px) {
            .battle-platform {
                flex: 0 0 58%;
            }
            .question-answer-container {
                max-height: 42vh;
            }
        }
        
        @media (max-width: 375px) {
            .battle-platform {
                flex: 0 0 55%;
            }
            .question-answer-container {
                max-height: 45vh;
            }
        }
        
        /* For very tall screens (portrait mobile) */
        @media (min-height: 800px) and (max-width: 768px) {
            .battle-platform {
                flex: 0 0 70%;
            }
            .question-answer-container {
                max-height: 30vh;
            }
        }
        
        /* For landscape orientation */
        @media (orientation: landscape) {
            .battle-container {
                flex-direction: row;
            }
            .battle-platform {
                flex: 0 0 60%;
                height: 100vh;
                border-radius: 0;
                border-top: 0;
                border-bottom: 0;
            }
            .question-answer-container {
                flex: 1;
                max-height: 100vh;
                border-radius: 0;
                border-top: 0;
                border-bottom: 0;
            }
        }
        
        /* For very wide screens (desktop landscape) */
        @media (min-width: 1024px) and (orientation: landscape) {
            .battle-platform {
                flex: 0 0 70%;
            }
            .question-answer-container {
                flex: 1;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-b from-sky-400 to-blue-600">
    <!-- Mobile-specific background for better performance -->
    <div class="fixed inset-0 bg-cover bg-center opacity-40 z-0" 
         style="background-image: url('assets/rice_background.png');" 
         id="battleBackground"></div>
    
    <!-- Language Toggle - Mobile Optimized -->
    <button id="langToggle" class="fixed top-2 right-2 z-50 touch-target
              bg-gradient-to-r from-yellow-400 to-amber-500 
              border-2 border-orange-600 
              rounded-xl 
              px-3 py-2 
              text-sm font-bold text-amber-900 
              hover:scale-105 active:scale-95
              transition-all duration-200 
              shadow-lg shadow-black/20
              flex items-center justify-center">
        <span class="text-base mr-1">üåê</span>
        <span id="langLabel" class="text-xs">TAG</span>
    </button>

    <!-- Back Button - Mobile Optimized -->
    <button onclick="window.location.href='era-selection.html'" 
            class="fixed top-2 left-2 z-50 touch-target
                   bg-gradient-to-r from-gray-300 to-gray-400 
                   border-2 border-gray-600 
                   rounded-xl 
                   px-3 py-2 
                   text-sm font-bold text-gray-800 
                   hover:scale-105 active:scale-95
                   transition-all duration-200 
                   shadow-lg shadow-black/20
                   flex items-center justify-center">
        <span data-lang-key="Back" class="text-xs">Back</span>
    </button>

    <!-- Battle Container - Fills entire screen -->
    <div class="battle-container">
        
        <!-- Battle Platform - Top section -->
        <div class="battle-platform relative 
                    bg-gradient-to-br from-amber-200 via-yellow-200 to-amber-300 
                    border-4 sm:border-6 md:border-8 border-amber-800 
                    shadow-2xl shadow-amber-900/30">
            
            <!-- HP Containers - Moved to top -->
            <div class="hp-container-left absolute top-4 left-4 sm:top-6 sm:left-6 md:top-8 md:left-8 
                        w-36 sm:w-40 md:w-48 z-20">
                <p id="playerName" class="text-black font-bold 
                          text-sm sm:text-base md:text-lg 
                          mb-1 text-center truncate">
                    Lapu-Lapu
                </p>
                <div class="h-5 sm:h-5 md:h-6 
                          bg-gradient-to-b from-gray-800 to-gray-900 
                          rounded-lg border border-yellow-600 
                          overflow-hidden shadow-inner">
                    <div id="playerHpBar" class="h-full bg-gradient-to-r from-green-500 to-green-400 transition-all duration-700" 
                         style="width: 100%"></div>
                </div>
                <p class="text-xs sm:text-sm text-gray-700 text-center mt-1" id="playerHpText">100/100</p>
            </div>

            <div class="hp-container-right absolute top-4 right-4 sm:top-6 sm:right-6 md:top-8 md:right-8 
                        w-36 sm:w-40 md:w-48 z-20">
                <p id="enemyName" class="text-black font-bold 
                          text-sm sm:text-base md:text-lg 
                          mb-1 text-center truncate">
                    Ferdinand Magellan
                </p>
                <div class="h-5 sm:h-5 md:h-6 
                          bg-gradient-to-b from-gray-800 to-gray-900 
                          rounded-lg border border-yellow-600 
                          overflow-hidden shadow-inner">
                    <div id="enemyHpBar" class="h-full bg-gradient-to-r from-green-500 to-green-400 transition-all duration-700" 
                         style="width: 100%"></div>
                </div>
                <p class="text-xs sm:text-sm text-gray-700 text-center mt-1" id="enemyHpText">100/100</p>
            </div>

            <!-- Characters - Very large to fill the space -->
            <div id="playerCharacter" class="character absolute bottom-4 left-4 sm:bottom-6 sm:left-6 md:bottom-8 md:left-8
                        w-44 h-44 sm:w-56 sm:h-56 md:w-72 md:h-72 lg:w-80 lg:h-80
                        transition-all duration-300 z-10">
                <img src="assets/lapulapu-idle.png" alt="Hero" id="playerSprite" 
                     class="sprite-image w-full h-full object-contain drop-shadow-2xl">
            </div>

            <div id="enemyCharacter" class="character absolute bottom-4 right-4 sm:bottom-6 sm:right-6 md:bottom-8 md:right-8
                        w-44 h-44 sm:w-56 sm:h-56 md:w-72 md:h-72 lg:w-80 lg:h-80
                        transition-all duration-300 z-10">
                <img src="assets/magellan-idle.png" alt="Enemy" id="enemySprite" 
                     class="sprite-image w-full h-full object-contain drop-shadow-2xl">
            </div>
        </div>

        <!-- Question & Answer Container - Bottom section -->
        <div class="question-answer-container relative 
                    bg-gradient-to-br from-amber-50 to-yellow-100 
                    border-4 sm:border-6 border-amber-800 
                    p-3 sm:p-4 md:p-5
                    shadow-2xl shadow-amber-900/30">
            
            <!-- Question Container -->
            <div class="question-container relative 
                        bg-gradient-to-br from-yellow-200 to-amber-200
                        border-3 border-amber-700
                        rounded-xl sm:rounded-2xl
                        p-3 sm:p-4
                        mb-3 sm:mb-4
                        shadow-inner shadow-amber-900/20">
                
                <div class="absolute -top-1 left-0 w-full h-2 bg-gradient-to-r from-amber-600 to-amber-700 rounded-t-xl"></div>
                <div class="absolute -bottom-1 left-0 w-full h-2 bg-gradient-to-r from-amber-600 to-amber-700 rounded-b-xl"></div>
                
                <div class="flex items-center justify-center mb-2">
                    <span class="bg-gradient-to-r from-amber-600 to-amber-700 text-white rounded-lg px-3 py-1 text-xs sm:text-sm font-bold shadow-md">
                        ‚ùì QUESTION
                    </span>
                </div>
                
                <p id="questionText" class="text-sm sm:text-base md:text-lg font-bold text-amber-900 
                         text-center 
                         min-h-[40px] sm:min-h-[50px]
                         flex items-center justify-center 
                         px-2 leading-tight sm:leading-normal">
                    Loading question...
                </p>
            </div>

            <!-- Answer Panel - Compact layout -->
            <div class="answer-panel">
                <div class="flex items-center justify-center mb-2 sm:mb-3">
                    <span class="bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg px-3 py-1 text-xs sm:text-sm font-bold shadow-md">
                        üîò ANSWERS
                    </span>
                </div>
                
                <div class="grid grid-cols-2 gap-2 sm:gap-3">
                    <button id="answerA" onclick="selectAnswer(0)" 
                            class="touch-target answer-btn 
                                   bg-gradient-to-r from-yellow-300 to-amber-300
                                   hover:from-yellow-400 hover:to-amber-400
                                   border-3 sm:border-4 border-orange-500 
                                   rounded-xl sm:rounded-2xl 
                                   p-2 sm:p-3 
                                   text-left 
                                   text-xs sm:text-sm md:text-base font-bold text-amber-900 
                                   hover:scale-105 active:scale-95 
                                   transition-all duration-200 
                                   shadow-lg shadow-orange-900/20
                                   disabled:opacity-50 disabled:cursor-not-allowed
                                   min-h-[40px] sm:min-h-[45px]
                                   flex items-center">
                        <span class="flex-shrink-0 mr-2 bg-gradient-to-r from-amber-600 to-amber-700 text-white rounded-lg px-2 py-1 text-xs font-bold">A</span>
                        <span id="answerAText" class="break-words flex-grow text-xs sm:text-sm">Loading...</span>
                    </button>
                    
                    <button id="answerB" onclick="selectAnswer(1)" 
                            class="touch-target answer-btn 
                                   bg-gradient-to-r from-yellow-300 to-amber-300
                                   hover:from-yellow-400 hover:to-amber-400
                                   border-3 sm:border-4 border-orange-500 
                                   rounded-xl sm:rounded-2xl 
                                   p-2 sm:p-3 
                                   text-left 
                                   text-xs sm:text-sm md:text-base font-bold text-amber-900 
                                   hover:scale-105 active:scale-95 
                                   transition-all duration-200 
                                   shadow-lg shadow-orange-900/20
                                   disabled:opacity-50 disabled:cursor-not-allowed
                                   min-h-[40px] sm:min-h-[45px]
                                   flex items-center">
                        <span class="flex-shrink-0 mr-2 bg-gradient-to-r from-amber-600 to-amber-700 text-white rounded-lg px-2 py-1 text-xs font-bold">B</span>
                        <span id="answerBText" class="break-words flex-grow text-xs sm:text-sm">Loading...</span>
                    </button>
                    
                    <button id="answerC" onclick="selectAnswer(2)" 
                            class="touch-target answer-btn 
                                   bg-gradient-to-r from-yellow-300 to-amber-300
                                   hover:from-yellow-400 hover:to-amber-400
                                   border-3 sm:border-4 border-orange-500 
                                   rounded-xl sm:rounded-2xl 
                                   p-2 sm:p-3 
                                   text-left 
                                   text-xs sm:text-sm md:text-base font-bold text-amber-900 
                                   hover:scale-105 active:scale-95 
                                   transition-all duration-200 
                                   shadow-lg shadow-orange-900/20
                                   disabled:opacity-50 disabled:cursor-not-allowed
                                   min-h-[40px] sm:min-h-[45px]
                                   flex items-center">
                        <span class="flex-shrink-0 mr-2 bg-gradient-to-r from-amber-600 to-amber-700 text-white rounded-lg px-2 py-1 text-xs font-bold">C</span>
                        <span id="answerCText" class="break-words flex-grow text-xs sm:text-sm">Loading...</span>
                    </button>
                    
                    <button id="answerD" onclick="selectAnswer(3)" 
                            class="touch-target answer-btn 
                                   bg-gradient-to-r from-yellow-300 to-amber-300
                                   hover:from-yellow-400 hover:to-amber-400
                                   border-3 sm:border-4 border-orange-500 
                                   rounded-xl sm:rounded-2xl 
                                   p-2 sm:p-3 
                                   text-left 
                                   text-xs sm:text-sm md:text-base font-bold text-amber-900 
                                   hover:scale-105 active:scale-95 
                                   transition-all duration-200 
                                   shadow-lg shadow-orange-900/20
                                   disabled:opacity-50 disabled:cursor-not-allowed
                                   min-h-[40px] sm:min-h-[45px]
                                   flex items-center">
                        <span class="flex-shrink-0 mr-2 bg-gradient-to-r from-amber-600 to-amber-700 text-white rounded-lg px-2 py-1 text-xs font-bold">D</span>
                        <span id="answerDText" class="break-words flex-grow text-xs sm:text-sm">Loading...</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Victory Modal - Mobile Optimized -->
    <div id="victoryModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="fixed inset-0 bg-gradient-to-br from-yellow-400 to-amber-500"></div>
        
        <div class="relative min-h-screen flex items-center justify-center p-4">
            <div class="bg-white/90 rounded-2xl sm:rounded-3xl 
                       p-4 sm:p-6 md:p-8 
                       max-w-lg w-full 
                       shadow-2xl shadow-black/30
                       transform transition-all duration-300">
                
                <h1 class="text-3xl sm:text-4xl md:text-5xl 
                          font-extrabold text-amber-800 
                          mb-4 sm:mb-6 
                          text-center drop-shadow-lg animate-bounce"
                    data-lang-key="victory">
                    üéâ VICTORY! üéâ
                </h1>
                
                <p class="text-lg sm:text-xl md:text-2xl 
                         text-amber-700 
                         mb-6 sm:mb-8 
                         text-center drop-shadow-lg"
                   data-lang-key="conqueredEra">
                    You have conquered this era!
                </p>
                
                <!-- Hero Achievement Display -->
                <div class="bg-gradient-to-br from-amber-50 to-yellow-50 
                           rounded-xl sm:rounded-2xl 
                           p-4 sm:p-5 
                           mb-6 sm:mb-8 
                           border-2 border-amber-600
                           shadow-lg">
                    <h2 class="text-xl sm:text-2xl font-bold text-amber-800 
                              mb-3 sm:mb-4 
                              text-center" 
                        data-lang-key="heroUnlocked">
                        üèÜ Hero Unlocked! üèÜ
                    </h2>
                    
                    <div class="flex justify-center mb-3 sm:mb-4">
                        <img id="unlockedHeroImage" src="" alt="Hero" 
                             class="w-24 h-24 sm:w-28 sm:h-28 md:w-32 md:h-32 
                                    object-contain animate-pulse">
                    </div>
                    
                    <p id="unlockedHeroName" 
                       class="text-lg sm:text-xl font-bold text-amber-900 
                              mb-2 text-center"></p>
                    
                    <p id="unlockedHeroDescription" 
                       class="text-sm sm:text-base text-amber-700 
                              text-center px-2"></p>
                </div>
                
                <!-- Navigation Options - Stack on mobile -->
                <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center">
                    <button id="nextEraBtn" onclick="proceedToNextEra()" 
                            class="touch-target
                                   bg-gradient-to-r from-green-500 to-green-600 
                                   text-white 
                                   px-6 py-3 
                                   rounded-xl 
                                   text-base sm:text-lg font-bold 
                                   hover:scale-105 active:scale-95
                                   transition-transform 
                                   shadow-lg shadow-green-900/30
                                   flex-1">
                        <span data-lang-key="nextEra">Next Era ‚Üí</span>
                    </button>
                    
                    <button onclick="location.href='era-selection.html'" 
                            class="touch-target
                                   bg-gradient-to-r from-blue-500 to-blue-600 
                                   text-white 
                                   px-6 py-3 
                                   rounded-xl 
                                   text-base sm:text-lg font-bold 
                                   hover:scale-105 active:scale-95
                                   transition-transform 
                                   shadow-lg shadow-blue-900/30
                                   flex-1">
                        <span data-lang-key="chooseEra">Choose Era</span>
                    </button>
                    
                    <button onclick="location.href='collection.html'" 
                            class="touch-target
                                   bg-gradient-to-r from-purple-500 to-purple-600 
                                   text-white 
                                   px-6 py-3 
                                   rounded-xl 
                                   text-base sm:text-lg font-bold 
                                   hover:scale-105 active:scale-95
                                   transition-transform 
                                   shadow-lg shadow-purple-900/30
                                   flex-1">
                        <span data-lang-key="viewCollection">View Collection</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Defeat Modal - Mobile Optimized -->
    <div id="defeatModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="fixed inset-0 bg-gradient-to-br from-red-600 to-red-800"></div>
        
        <div class="relative min-h-screen flex items-center justify-center p-4">
            <div class="bg-white/90 rounded-2xl sm:rounded-3xl 
                       p-6 sm:p-8 
                       max-w-md w-full 
                       shadow-2xl shadow-black/30
                       transform transition-all duration-300">
                
                <h1 class="text-3xl sm:text-4xl md:text-5xl 
                          font-extrabold text-red-700 
                          mb-4 sm:mb-6 
                          text-center drop-shadow-lg"
                    data-lang-key="defeated">
                    üíî DEFEATED üíî
                </h1>
                
                <p class="text-lg sm:text-xl md:text-2xl 
                         text-red-600 
                         mb-8 sm:mb-10 
                         text-center drop-shadow-lg"
                   data-lang-key="tryHarder">
                    Study harder and try again!
                </p>
                
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onclick="restartBattle()" 
                            class="touch-target
                                   bg-gradient-to-r from-red-500 to-red-600 
                                   text-white 
                                   px-8 py-3 
                                   rounded-xl 
                                   text-lg sm:text-xl font-bold 
                                   hover:scale-105 active:scale-95
                                   transition-transform 
                                   shadow-lg shadow-red-900/30
                                   flex-1">
                        <span data-lang-key="retry">Retry Battle</span>
                    </button>
                    
                    <button onclick="location.href='index.html'" 
                            class="touch-target
                                   bg-gradient-to-r from-gray-500 to-gray-600 
                                   text-white 
                                   px-8 py-3 
                                   rounded-xl 
                                   text-lg sm:text-xl font-bold 
                                   hover:scale-105 active:scale-95
                                   transition-transform 
                                   shadow-lg shadow-gray-900/30
                                   flex-1">
                        <span data-lang-key="mainMenu">Main Menu</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Damage Indicators -->
    <div id="damageIndicators" class="fixed inset-0 pointer-events-none z-40"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-blue-600 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="w-16 h-16 sm:w-20 sm:h-20 border-4 border-white/30 border-t-white rounded-full animate-spin mb-4"></div>
            <div class="text-white text-lg font-bold">Loading Battle...</div>
        </div>
    </div>

    <script src="js/eraData.js"></script>
    <script src="js/questions.js"></script>
    <script src="js/battle.js"></script>
    <script src="js/language.js"></script>
    
    <script>
        // Mobile-specific optimizations
        document.addEventListener('DOMContentLoaded', function() {
            // Prevent zoom on double-tap
            document.addEventListener('touchstart', function(event) {
                if (event.touches.length > 1) {
                    event.preventDefault();
                }
            }, { passive: false });
            
            // Better touch handling for buttons
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.95)';
                });
                button.addEventListener('touchend', function() {
                    this.style.transform = '';
                });
            });
            
            // Handle orientation change
            window.addEventListener('orientationchange', function() {
                setTimeout(() => {
                    window.scrollTo(0, 0);
                }, 100);
            });
            
            // Hide loading overlay after content loads
            setTimeout(() => {
                document.getElementById('loadingOverlay')?.classList.add('hidden');
            }, 500);
            
            // Prevent any scrolling on the page
            document.addEventListener('touchmove', function(e) {
                e.preventDefault();
            }, { passive: false });
            
            document.addEventListener('wheel', function(e) {
                e.preventDefault();
            }, { passive: false });
        });
        
        function restartBattle() {
            location.reload();
        }
    </script>
</body>
</html>
