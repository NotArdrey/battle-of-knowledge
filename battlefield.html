<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Battle - Battle of Knowledge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles/animations.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Baloo 2', cursive; 
            -webkit-tap-highlight-color: transparent;
        }
        .sprite-image { 
            image-rendering: pixelated;
            pointer-events: none;
        }
        /* Touch optimization */
        .touch-target {
            min-height: 44px;
            min-width: 44px;
            touch-action: manipulation;
        }
        /* Prevent text selection on buttons */
        button {
            user-select: none;
            -webkit-user-select: none;
        }
        /* Custom scrollbar for mobile */
        ::-webkit-scrollbar {
            width: 4px;
        }
        /* Battle platform responsive scaling */
        @media (max-width: 640px) {
            .battle-platform {
                transform: scale(0.95);
                transform-origin: top center;
            }
            /* Mobile: Position HP bars closer to characters */
            .hp-container-left {
                top: auto !important;
                bottom: 9rem !important;
                left: 0.5rem !important;
            }
            .hp-container-right {
                top: auto !important;
                bottom: 9rem !important;
                right: 0.5rem !important;
            }
        }
        @media (max-width: 480px) {
            .battle-platform {
                transform: scale(0.9);
            }
            .hp-container-left {
                bottom: 8.5rem !important;
            }
            .hp-container-right {
                bottom: 8.5rem !important;
            }
        }
        @media (max-width: 400px) {
            .battle-platform {
                transform: scale(0.88);
            }
            .hp-container-left {
                bottom: 8rem !important;
                left: 0.25rem !important;
            }
            .hp-container-right {
                bottom: 8rem !important;
                right: 0.25rem !important;
            }
        }
        @media (max-width: 375px) {
            .battle-platform {
                transform: scale(0.86);
            }
            .hp-container-left {
                bottom: 7.5rem !important;
            }
            .hp-container-right {
                bottom: 7.5rem !important;
            }
            /* Reduce character size */
            .character {
                width: 6rem !important;
                height: 6rem !important;
            }
        }
        @media (max-width: 360px) {
            .battle-platform {
                transform: scale(0.85);
            }
            .hp-container-left {
                bottom: 7rem !important;
            }
            .hp-container-right {
                bottom: 7rem !important;
            }
            .character {
                width: 5.5rem !important;
                height: 5.5rem !important;
            }
        }
        @media (max-width: 344px) {
            .battle-platform {
                transform: scale(0.82);
            }
            .hp-container-left {
                bottom: 6.5rem !important;
                left: 0.15rem !important;
            }
            .hp-container-right {
                bottom: 6.5rem !important;
                right: 0.15rem !important;
            }
            .character {
                width: 5rem !important;
                height: 5rem !important;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-b from-sky-400 to-blue-600 min-h-screen overflow-x-hidden">
    <!-- Mobile-specific background for better performance -->
    <div class="fixed inset-0 bg-cover bg-center opacity-40 z-0" 
         style="background-image: url('assets/rice_background.png');" 
         id="battleBackground"></div>
    
    <!-- Language Toggle - Mobile Optimized -->
    <button id="langToggle" class="fixed top-2 right-2 z-50 touch-target
              bg-gradient-to-r from-yellow-400 to-amber-500 
              border-2 border-orange-600 
              rounded-xl 
              px-3 py-2 
              text-sm font-bold text-amber-900 
              hover:scale-105 active:scale-95
              transition-all duration-200 
              shadow-lg shadow-black/20
              flex items-center justify-center">
        <span class="text-base mr-1">üåê</span>
        <span id="langLabel" class="text-xs">TAG</span>
    </button>

    <!-- Back Button - Mobile Optimized -->
    <button onclick="window.location.href='era-selection.html'" 
            class="fixed top-2 left-2 z-50 touch-target
                   bg-gradient-to-r from-gray-300 to-gray-400 
                   border-2 border-gray-600 
                   rounded-xl 
                   px-3 py-2 
                   text-sm font-bold text-gray-800 
                   hover:scale-105 active:scale-95
                   transition-all duration-200 
                   shadow-lg shadow-black/20
                   flex items-center justify-center">
        <span data-lang-key="Back" class="text-xs">Back</span>
    </button>

    <!-- Battle Container -->
    <div class="relative w-full min-h-screen flex flex-col items-center justify-center px-2 py-4">
        
        <!-- Battle Platform - Responsive -->
        <div class="battle-platform relative 
                    w-full max-w-3xl 
                    h-[35vh] min-h-[250px] max-h-[300px]
                    bg-gradient-to-br from-amber-200 via-yellow-200 to-amber-300 
                    border-4 sm:border-6 md:border-8 border-amber-800 
                    rounded-2xl sm:rounded-3xl
                    shadow-2xl shadow-amber-900/30
                    mb-4 sm:mb-6">
            
            <!-- Platform Decorations - Responsive -->
            <div class="absolute -top-2 -left-2 sm:-top-3 sm:-left-3 w-4 h-4 sm:w-6 sm:h-6 bg-gradient-to-br from-amber-600 to-amber-800 rounded-full border-2 border-amber-900"></div>
            <div class="absolute -top-2 -right-2 sm:-top-3 sm:-right-3 w-4 h-4 sm:w-6 sm:h-6 bg-gradient-to-br from-amber-600 to-amber-800 rounded-full border-2 border-amber-900"></div>
            <div class="absolute -bottom-2 -left-2 sm:-bottom-3 sm:-left-3 w-4 h-4 sm:w-6 sm:h-6 bg-gradient-to-br from-amber-600 to-amber-800 rounded-full border-2 border-amber-900"></div>
            <div class="absolute -bottom-2 -right-2 sm:-bottom-3 sm:-right-3 w-4 h-4 sm:w-6 sm:h-6 bg-gradient-to-br from-amber-600 to-amber-800 rounded-full border-2 border-amber-900"></div>

            <!-- HP Containers - Mobile First -->
            <div class="hp-container-left absolute top-3 left-3 sm:top-4 sm:left-4 md:top-6 md:left-6 
                        w-32 sm:w-32 md:w-40">
                <p id="playerName" class="text-black font-bold 
                          text-sm sm:text-sm md:text-base 
                          mb-1 text-center truncate">
                    Lapu-Lapu
                </p>
                <div class="h-4 sm:h-4 md:h-5 
                          bg-gradient-to-b from-gray-800 to-gray-900 
                          rounded-lg border border-yellow-600 
                          overflow-hidden shadow-inner">
                    <div id="playerHpBar" class="h-full bg-gradient-to-r from-green-500 to-green-400 transition-all duration-700" 
                         style="width: 100%"></div>
                </div>
                <p class="text-xs text-gray-700 text-center mt-1" id="playerHpText">100/100</p>
            </div>

            <div class="hp-container-right absolute top-3 right-3 sm:top-4 sm:right-4 md:top-6 md:right-6 
                        w-32 sm:w-32 md:w-40">
                <p id="enemyName" class="text-black font-bold 
                          text-sm sm:text-sm md:text-base 
                          mb-1 text-center truncate">
                    Ferdinand Magellan
                </p>
                <div class="h-4 sm:h-4 md:h-5 
                          bg-gradient-to-b from-gray-800 to-gray-900 
                          rounded-lg border border-yellow-600 
                          overflow-hidden shadow-inner">
                    <div id="enemyHpBar" class="h-full bg-gradient-to-r from-green-500 to-green-400 transition-all duration-700" 
                         style="width: 100%"></div>
                </div>
                <p class="text-xs text-gray-700 text-center mt-1" id="enemyHpText">100/100</p>
            </div>

            <!-- Characters - Responsive Sizing - Larger on Mobile -->
            <div id="playerCharacter" class="character absolute bottom-4 left-3 sm:bottom-6 sm:left-4 md:bottom-8 md:left-8
                        w-28 h-28 sm:w-24 sm:h-24 md:w-32 md:h-32 lg:w-40 lg:h-40
                        transition-all duration-300">
                <img src="assets/lapulapu-idle.png" alt="Hero" id="playerSprite" 
                     class="sprite-image w-full h-full object-contain">
            </div>

            <div id="enemyCharacter" class="character absolute bottom-4 right-3 sm:bottom-6 sm:right-4 md:bottom-8 md:right-8
                        w-28 h-28 sm:w-24 sm:h-24 md:w-32 md:h-32 lg:w-40 lg:h-40
                        transition-all duration-300">
                <img src="assets/magellan-idle.png" alt="Enemy" id="enemySprite" 
                     class="sprite-image w-full h-full object-contain">
            </div>
        </div>

        <!-- Question Container - Mobile Optimized -->
        <div class="relative 
                    w-full max-w-2xl 
                    bg-gradient-to-br from-amber-50 to-yellow-100 
                    border-3 sm:border-4 border-amber-800 
                    rounded-xl sm:rounded-2xl
                    p-3 sm:p-4 md:p-6
                    shadow-2xl shadow-amber-900/30
                    mb-4">
            
            <div class="absolute -top-1 left-0 w-full h-2 bg-gradient-to-r from-amber-700 via-amber-800 to-amber-700 rounded-t-xl"></div>
            <div class="absolute -bottom-1 left-0 w-full h-2 bg-gradient-to-r from-amber-700 via-amber-800 to-amber-700 rounded-b-xl"></div>
            
            <p id="questionText" class="text-sm sm:text-base md:text-lg font-bold text-amber-900 
                     text-center 
                     min-h-[60px] sm:min-h-[70px] md:min-h-[80px]
                     flex items-center justify-center 
                     px-2 leading-tight sm:leading-normal">
                Loading question...
            </p>
        </div>

        <!-- Answer Panel - Mobile Optimized -->
        <div class="w-full max-w-4xl px-2">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                <button id="answerA" onclick="selectAnswer(0)" 
                        class="touch-target answer-btn 
                               bg-gradient-to-r from-yellow-400 to-amber-400 
                               border-3 sm:border-4 border-orange-600 
                               rounded-xl sm:rounded-2xl 
                               p-3 sm:p-4 
                               text-left 
                               text-sm sm:text-base font-bold text-amber-900 
                               hover:scale-105 active:scale-95 
                               transition-all duration-200 
                               shadow-lg shadow-orange-900/20
                               disabled:opacity-50 disabled:cursor-not-allowed
                               min-h-[60px] sm:min-h-[70px]
                               flex items-center">
                    <span class="flex-shrink-0 mr-2 bg-amber-600 text-white rounded-lg px-2 py-1 text-xs">A</span>
                    <span id="answerAText" class="break-words flex-grow">Loading...</span>
                </button>
                
                <button id="answerB" onclick="selectAnswer(1)" 
                        class="touch-target answer-btn 
                               bg-gradient-to-r from-yellow-400 to-amber-400 
                               border-3 sm:border-4 border-orange-600 
                               rounded-xl sm:rounded-2xl 
                               p-3 sm:p-4 
                               text-left 
                               text-sm sm:text-base font-bold text-amber-900 
                               hover:scale-105 active:scale-95 
                               transition-all duration-200 
                               shadow-lg shadow-orange-900/20
                               disabled:opacity-50 disabled:cursor-not-allowed
                               min-h-[60px] sm:min-h-[70px]
                               flex items-center">
                    <span class="flex-shrink-0 mr-2 bg-amber-600 text-white rounded-lg px-2 py-1 text-xs">B</span>
                    <span id="answerBText" class="break-words flex-grow">Loading...</span>
                </button>
                
                <button id="answerC" onclick="selectAnswer(2)" 
                        class="touch-target answer-btn 
                               bg-gradient-to-r from-yellow-400 to-amber-400 
                               border-3 sm:border-4 border-orange-600 
                               rounded-xl sm:rounded-2xl 
                               p-3 sm:p-4 
                               text-left 
                               text-sm sm:text-base font-bold text-amber-900 
                               hover:scale-105 active:scale-95 
                               transition-all duration-200 
                               shadow-lg shadow-orange-900/20
                               disabled:opacity-50 disabled:cursor-not-allowed
                               min-h-[60px] sm:min-h-[70px]
                               flex items-center">
                    <span class="flex-shrink-0 mr-2 bg-amber-600 text-white rounded-lg px-2 py-1 text-xs">C</span>
                    <span id="answerCText" class="break-words flex-grow">Loading...</span>
                </button>
                
                <button id="answerD" onclick="selectAnswer(3)" 
                        class="touch-target answer-btn 
                               bg-gradient-to-r from-yellow-400 to-amber-400 
                               border-3 sm:border-4 border-orange-600 
                               rounded-xl sm:rounded-2xl 
                               p-3 sm:p-4 
                               text-left 
                               text-sm sm:text-base font-bold text-amber-900 
                               hover:scale-105 active:scale-95 
                               transition-all duration-200 
                               shadow-lg shadow-orange-900/20
                               disabled:opacity-50 disabled:cursor-not-allowed
                               min-h-[60px] sm:min-h-[70px]
                               flex items-center">
                    <span class="flex-shrink-0 mr-2 bg-amber-600 text-white rounded-lg px-2 py-1 text-xs">D</span>
                    <span id="answerDText" class="break-words flex-grow">Loading...</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Victory Modal - Mobile Optimized -->
    <div id="victoryModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="fixed inset-0 bg-gradient-to-br from-yellow-400 to-amber-500"></div>
        
        <div class="relative min-h-screen flex items-center justify-center p-4">
            <div class="bg-white/90 rounded-2xl sm:rounded-3xl 
                       p-4 sm:p-6 md:p-8 
                       max-w-lg w-full 
                       shadow-2xl shadow-black/30
                       transform transition-all duration-300">
                
                <h1 class="text-3xl sm:text-4xl md:text-5xl 
                          font-extrabold text-amber-800 
                          mb-4 sm:mb-6 
                          text-center drop-shadow-lg animate-bounce">
                    üéâ VICTORY! üéâ
                </h1>
                
                <p class="text-lg sm:text-xl md:text-2xl 
                         text-amber-700 
                         mb-6 sm:mb-8 
                         text-center drop-shadow-lg">
                    You have conquered this era!
                </p>
                
                <!-- Hero Achievement Display -->
                <div class="bg-gradient-to-br from-amber-50 to-yellow-50 
                           rounded-xl sm:rounded-2xl 
                           p-4 sm:p-5 
                           mb-6 sm:mb-8 
                           border-2 border-amber-600
                           shadow-lg">
                    <h2 class="text-xl sm:text-2xl font-bold text-amber-800 
                              mb-3 sm:mb-4 
                              text-center" 
                        data-lang-key="heroUnlocked">
                        üèÜ Hero Unlocked! üèÜ
                    </h2>
                    
                    <div class="flex justify-center mb-3 sm:mb-4">
                        <img id="unlockedHeroImage" src="" alt="Hero" 
                             class="w-24 h-24 sm:w-28 sm:h-28 md:w-32 md:h-32 
                                    object-contain animate-pulse">
                    </div>
                    
                    <p id="unlockedHeroName" 
                       class="text-lg sm:text-xl font-bold text-amber-900 
                              mb-2 text-center"></p>
                    
                    <p id="unlockedHeroDescription" 
                       class="text-sm sm:text-base text-amber-700 
                              text-center px-2"></p>
                </div>
                
                <!-- Navigation Options - Stack on mobile -->
                <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center">
                    <button id="nextEraBtn" onclick="proceedToNextEra()" 
                            class="touch-target
                                   bg-gradient-to-r from-green-500 to-green-600 
                                   text-white 
                                   px-6 py-3 
                                   rounded-xl 
                                   text-base sm:text-lg font-bold 
                                   hover:scale-105 active:scale-95
                                   transition-transform 
                                   shadow-lg shadow-green-900/30
                                   flex-1">
                        <span data-lang-key="nextEra">Next Era ‚Üí</span>
                    </button>
                    
                    <button onclick="location.href='era-selection.html'" 
                            class="touch-target
                                   bg-gradient-to-r from-blue-500 to-blue-600 
                                   text-white 
                                   px-6 py-3 
                                   rounded-xl 
                                   text-base sm:text-lg font-bold 
                                   hover:scale-105 active:scale-95
                                   transition-transform 
                                   shadow-lg shadow-blue-900/30
                                   flex-1">
                        <span data-lang-key="chooseEra">Choose Era</span>
                    </button>
                    
                    <button onclick="location.href='collection.html'" 
                            class="touch-target
                                   bg-gradient-to-r from-purple-500 to-purple-600 
                                   text-white 
                                   px-6 py-3 
                                   rounded-xl 
                                   text-base sm:text-lg font-bold 
                                   hover:scale-105 active:scale-95
                                   transition-transform 
                                   shadow-lg shadow-purple-900/30
                                   flex-1">
                        <span data-lang-key="viewCollection">View Collection</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Defeat Modal - Mobile Optimized -->
    <div id="defeatModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="fixed inset-0 bg-gradient-to-br from-red-600 to-red-800"></div>
        
        <div class="relative min-h-screen flex items-center justify-center p-4">
            <div class="bg-white/90 rounded-2xl sm:rounded-3xl 
                       p-6 sm:p-8 
                       max-w-md w-full 
                       shadow-2xl shadow-black/30
                       transform transition-all duration-300">
                
                <h1 class="text-3xl sm:text-4xl md:text-5xl 
                          font-extrabold text-red-700 
                          mb-4 sm:mb-6 
                          text-center drop-shadow-lg">
                    üíî DEFEATED üíî
                </h1>
                
                <p class="text-lg sm:text-xl md:text-2xl 
                         text-red-600 
                         mb-8 sm:mb-10 
                         text-center drop-shadow-lg"
                   data-lang-key="tryHarder">
                    Study harder and try again!
                </p>
                
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onclick="restartBattle()" 
                            class="touch-target
                                   bg-gradient-to-r from-red-500 to-red-600 
                                   text-white 
                                   px-8 py-3 
                                   rounded-xl 
                                   text-lg sm:text-xl font-bold 
                                   hover:scale-105 active:scale-95
                                   transition-transform 
                                   shadow-lg shadow-red-900/30
                                   flex-1">
                        <span data-lang-key="retry">Retry Battle</span>
                    </button>
                    
                    <button onclick="location.href='index.html'" 
                            class="touch-target
                                   bg-gradient-to-r from-gray-500 to-gray-600 
                                   text-white 
                                   px-8 py-3 
                                   rounded-xl 
                                   text-lg sm:text-xl font-bold 
                                   hover:scale-105 active:scale-95
                                   transition-transform 
                                   shadow-lg shadow-gray-900/30
                                   flex-1">
                        <span data-lang-key="mainMenu">Main Menu</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Damage Indicators -->
    <div id="damageIndicators" class="fixed inset-0 pointer-events-none z-40"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-blue-600 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="w-16 h-16 sm:w-20 sm:h-20 border-4 border-white/30 border-t-white rounded-full animate-spin mb-4"></div>
            <p class="text-white text-lg font-bold">Loading Battle...</p>
        </div>
    </div>

    <script src="js/eraData.js"></script>
    <script src="js/questions.js"></script>
    <script src="js/battle.js"></script>
    <script src="js/language.js"></script>
    
    <script>
        // Mobile-specific optimizations
        document.addEventListener('DOMContentLoaded', function() {
            // Prevent zoom on double-tap
            document.addEventListener('touchstart', function(event) {
                if (event.touches.length > 1) {
                    event.preventDefault();
                }
            }, { passive: false });
            
            // Better touch handling for buttons
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.95)';
                });
                button.addEventListener('touchend', function() {
                    this.style.transform = '';
                });
            });
            
            // Handle orientation change
            window.addEventListener('orientationchange', function() {
                setTimeout(() => {
                    window.scrollTo(0, 0);
                }, 100);
            });
            
            // Hide loading overlay after content loads
            setTimeout(() => {
                document.getElementById('loadingOverlay')?.classList.add('hidden');
            }, 500);
        });
        
        function restartBattle() {
            location.reload();
        }
    </script>
</body>
</html>